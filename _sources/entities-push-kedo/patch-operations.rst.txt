Операции, доступные в PATCH запросах
====================================

Add
---

Добавляет значение в массив.

.. code-block::

    { "op" : "Add", "path" : "/array", "value" : { "name" : "Ivan"} }

Remove
------

Удаляет значение из массива. Для удаления значения нужно обязательно передать id удаляемого элемента.

.. code-block::

    { "op" : "Remove", "path" : "/array/f96b8aa3-e215-46ed-89f3-64079f993da9" } 

Replace
-------

Изменяет значение у поля объекта:

.. code-block::

    { "op": "Replace", "path": "/name", "value" : "Ivan" }

Изменяет элемент массива:

.. code-block::

    { "op": "Replace", "path": "/array/f96b8aa3-e215-46ed-89f3-64079f993da9/name" : "Ivan" }

Работа с массивами
------------------

При операциях с массивами мы требуем Id, который содержится внутри элемента массива, 
и не позволяем использовать индекс в массиве. С нашей точки зрения это делает конкурентный доступ 
к элементам массива более безопасным и позволяет совершать операции идемпотентным способом.

Если бы мы позволяли совершать операции по индексу в массиве, например был бы возможен следующий кейс:

Шаг 1. Исходный массив [1, 2, 3, 4, 5, 6]

Шаг 2. «Интеграция 1» прочитала исходный массив, сформировала запрос на удаление элемента с индексом 2:

.. code-block::

    { "op" : "Remove", "path" : "/2" }

Ожидание после операции: «Элемент 3 отсутствует в массиве».

Шаг 3. «Интеграция 2» прочитала исходный массив. Сформировала запрос на удаление элемента с индексом 4:

.. code-block::

    { "op" : "Remove", "path" : "/4" }

Ожидание после операции: «Элемент 5 отсутствует в массиве». 

Шаг 4. Вначале выполнился запрос «Интеграции 1». Она получила ожидаем результат.

Шаг 5. Затем выполнился запрос «Интеграции 2». Вместо того, что бы удалить «Элемент 5», она удалит «Элемент 6». 
Так как после выполнения п.4 индексы в массиве сдвинулись.

Если у элементов массива нет идентификаторов и нужно изменить содержимое массива, 
то это можно сделать только целиком перезаписав весь массив:

.. code-block::

    { "op" : "Replace", "path" : "/array", "value" : [ 1, 2, 3, 4] }